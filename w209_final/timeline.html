<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="static/css/main.css">
    <title>NASA Astronauts</title>
  </head>
  <body>
  <header>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
      <a class="navbar-brand">NASA Astronauts</a>
      <button class="navbar-toggler" data-target="#top_nav" data-toggle="collapse" aria-controls="top_nav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div id="top_nav" class="collapse navbar-collapse">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item">
            <a class="nav-link" href="index.html" tabindex="1">Introduction</a>
          </li>
          <li class="nav-item active">
            <a class="nav-link" href="timeline.html" tabindex="2">Timeline<span class="sr-only">(current)</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="backgrounds.html" tabindex="3">Becoming An Astronaut</a>
          </li>
        </ul>
      </div>
    </nav>
    <div class="container h-100">
      <div class="d-flex h-100 text-center align-items-center">
        <div class="w-100 text-white">
          <h1 class="display-3">The Astronaut Timeline</h1>
          <p class="lead mb-0">78 Years in Space</p>
        </div>
      </div>
    </div>
  </header>
  <section class="my-5">
    <div class="container text-white">
      <div class="row">
        <div class="col-md-8 mx-auto">
          Lorem ipsum, dolor sit amet consectetur adipisicing elit. Deleniti, veritatis exercitationem! Veniam nulla temporibus laborum quo perferendis ab dolor modi porro accusantium distinctio assumenda, dicta qui tenetur quidem. Obcaecati, laboriosam?
        </div>
      </div>
      <br>
      <div class="row">
        <div class="col-md-6 butt" id="button1">Astronaut Military vs Civilian</div>
        <div class="col-md-6 butt" id="button2">Astronaut Demographics</div>
      </div>
      <div class="row">
        <div class="col-md-9 mx-auto" id="sb_chart"></div>
      </div>
    </div>
  </section>


    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: jQuery and Bootstrap Bundle (includes Popper) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.13.0/d3.min.js"></script>
    <script src="static/js/main.js"></script>

    <!-- Option 2: jQuery, Popper.js, and Bootstrap JS
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>
    -->
    <script type="text/javascript">
    // set up svg sizes
    var margin = {top: 20, right: 20, bottom: 70, left: 40},
        width = 800 - margin.left - margin.right,
        height = 400 - margin.top - margin.bottom;
    var x, y, xAxis, yAxis; //Empty, for now

    //Nasa colors
    var nasa_colors = ["#FC3D21","#0B3D91"];
    var milciv_colors = ['#e6d8b3','#6B8E23'];

    // import data 
    d3.json("/static/data/gen_grp.txt", function(data) {
      dataset = data;

      // Set up stack
      var stack = d3.stack().keys(["pctW","pctM"]);

      //data, stacked
      var series = stack(dataset);

      //Set up scales
      var xScale = d3.scaleBand()
        .domain(d3.range(dataset.length))
        .rangeRound([0, width], .05)
        .paddingInner(0.05);
      var yScale = d3.scaleLinear()
        .domain([0, d3.max(dataset, function(d) {
            return d.pctW + d.pctM;})])
        .range([0, height]);
              
      //Create SVG element
      var svg = d3.select("#sb_chart").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform",
              "translate(" + margin.left + "," + margin.top + ")");

      // Add a group for each row of data
      var groups = svg.selectAll("g")
        .data(series)
        .enter()
        .append("g")
        .style("fill", function(d, i) {
          return nasa_colors[i];
        });

      // set up tooltip
      var tooltip = d3.select("body")
        .append("div")
        .style("opacity", 0)
        .attr("class", "tooltip")
        .style("background-color", "white")
        .style("border", "solid")
        .style("border-width", "1px")
        .style("border-radius", "5px")
        .style("padding", "10px")

      // Add a rect for each data value
      var rects = groups.selectAll("rect")
        .data(function(d) { return d; })
        .enter()
        .append("rect")
        .attr("x", function(d, i) {
          return xScale(i);
        })
        .attr("y", function(d) {
          return yScale(d[0]);
        })
        .attr("height", function(d) {
          return yScale(d[1]) - yScale(d[0])
        })
        .attr("width", xScale.bandwidth())
        .on("mouseover.men", function(d, i) {
          return tooltip.style("opacity", 1)
          .html("<h5>Group: " + (i+1) + "</h5>" + 
            "Women: " + series[0][i]["data"]["W"] + "<br>" +
            "Men: " + series[0][i]["data"]["M"] + "<br><br>"+
            "<img src=\"static/images/grp_"+(i+1)+".jpg\" >")})
        .on("mousemove", function(d){
          return tooltip.style("top", (event.pageY-10)+"px")
            .style("left",(event.pageX+10)+"px");})
        .on("mouseout", function(d) {
          return tooltip.style("opacity", 0);});

      //axis
      var xAxis = d3.axisBottom()
        .scale(xScale);

      svg.append("g")
        .attr("class", "x-axis")
        .attr("id", "x-axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xAxis);

      // text label for the x axis
      // TODO: Figure out why we aren't seeing the group or number.
        svg.append("text")
        .attr("class", "x-axis-label")
        .attr("id", "x-axis-label")              
        .attr("transform",
          "translate(" + ((width)/2) + " ," + 
          (height + margin.top + margin.bottom/2) + ")")
        .style("text-anchor", "middle")
        .text("Group");
      
      // Change vis data to Mil vs Civ
      d3.select("#button1")
        .on("click", function() {
        console.log("Ouch!")

        dataset = data;
        console.log(dataset);

        // Set up stack
        var stack = d3.stack().keys(["pctCiv","pctMil"]);

        //data, stacked
        var series = stack(dataset);
        console.log(series);

        //Set up scale
        var yScale = d3.scaleLinear()
          .domain([0, d3.max(dataset, function(d) {
              return d.pctCiv + d.pctMil;})])
          .range([0, height]);

        // Add a group for each row of data
        groups.data(series)
          .transition().duration(1000)
          .style("fill", function(d, i) {
            return milciv_colors[i];
          });

        // Change rect for each data value
        rects.data(function(d) { return d; })
          .transition().duration(1000)
          .attr("y", function(d) {
            return yScale(d[0]);
          })
          .attr("height", function(d) {
            return yScale(d[1]) - yScale(d[0])
          })
        
        // Change mouseover  
        rects.on("mouseover.mil", function(d, i) {
          return tooltip.style("opacity", 1)
          .html("<h5>Group: " + (i+1) + "</h5>" + 
            "Military: " + series[0][i]["data"]["Mil"] + "<br>" +
            "Civilian: " + series[0][i]["data"]["Civ"] + "<br><br>"+
            "<img src=\"static/images/grp_"+(i+1)+".jpg\" >")});
      });

      // Change vis data to Men vs women
      d3.select("#button2")
        .on("click", function() {
        console.log("Ew, stop!")

        dataset = data;
        console.log(dataset);

        // Set up stack
        var stack = d3.stack().keys(["pctW","pctM"]);

        //data, stacked
        var series = stack(dataset);
        console.log(series);

        //Set up scale
        var yScale = d3.scaleLinear()
          .domain([0, d3.max(dataset, function(d) {
              return d.pctM + d.pctW;})])
          .range([0, height]);

        // Add a group for each row of data
        groups.data(series)
          .transition().duration(1000)
          .style("fill", function(d, i) {
            return nasa_colors[i];
          });

        // Change rect for each data value
        rects.data(function(d) { return d; })
          .transition().duration(1000)
          .attr("y", function(d) {
            return yScale(d[0]);
          })
          .attr("height", function(d) {
            return yScale(d[1]) - yScale(d[0])
          })
        
        // Change mouseover  
        rects.on("mouseover.mil", function(d, i) {
          return tooltip.style("opacity", 1)
          .html("<h5>Group: " + (i+1) + "</h5>" + 
            "Women: " + series[0][i]["data"]["W"] + "<br>" +
            "Men: " + series[0][i]["data"]["M"] + "<br><br>"+
            "<img src=\"static/images/grp_"+(i+1)+".jpg\" >")});
      });

      });
    </script>
  </body>
</html>